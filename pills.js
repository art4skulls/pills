let paperStyle,xyPillNumber,disrupted,whiteCaps,nonDisruptedTablets,pallet,paper,scalez,C,shaders,shadowPill,openable=!0,shadows=!0,seed=Date.now(),pillPointer=0,pillArray=[],whratio=1.4,plist=[],minYSpacing=.03;function pallets(){let e=hex2rgba(["40cefd","ff418a","24ff5e","fff719","f51d00","6184d8","50c5b7","9cec5b","f4fa50","f54791","ed7b84","fc8f4c","7eadb7","7eb77f","9b5de5","f15bb5","fee440","00bbf9","00f5d4","606060","cccccc"]);plist.push(e),e=hex2rgba(["13445e","023e8a","0077b6","0096c7","00b4d8","48cae4","90e0ef","ade8f4","caf0f8"]),plist.push(e),e=hex2rgba(["fbf8cc","fde4cf","ffcfd2","f1c0e8","cfbaf0","a3c4f3","90dbf4","8eecf5","98f5e1","b9fbc0"]),plist.push(e),e=hex2rgba(["014737","03543f","046c4e","057a55","0e9f6e","31c48d","84e1bc","bcf0da","def7ec","f3faf7"]),plist.push(e),e=hex2rgba(["fac901","fcfcfc","dd0100","225095"]),plist.push(e),e=hex2rgba(["221219","005f73","0a9396","94d2bd","e9d8a6","ee9b00","ca6702","bb3e03","ae2012","9b2226"]),plist.push(e),e=hex2rgba(["f8f9fa","e9ecef","dee2e6","ced4da","adb5bd","6c757d","495057","343a40","212529"]),plist.push(e)}function setup(){seed=(new Date).getTime();let e=prompt("Seed?");e&&(seed=int(e)),pillPointer=0,pillArray=[],paper=!0,pallets(),shaders=null,pixelDensity(2),reseed(seed);C=createCanvas(1024,1024),scalez=C.width/600,C.parent("canvas"),setCanvas(C),setAppName("PillsNThrills-"),randomise(),createPills()}function randomise(){console.log("SEED:"+seed),reseed(seed),paperStyle=rarray(["pure","paper","black"]),xyPillNumber=8+floor(random(32)),disrupted=random(1)>.5,whiteCaps=random(1)>.5,nonDisruptedTablets=!disrupted&&random(1)>.6,pallet=floor(random(plist.length)),"black"==paperStyle&&random(1)>.7&&(paperStyle="black",xyPillNumber=128,minYSpacing=.01)}function createPills(){createBlissPills()}function createBlissPills(){var e;console.log("Welcome to the pharmacy.............."),console.log("Style: "+paperStyle),console.log("Chaotic: "+disrupted),console.log("WhiteCaps: "+whiteCaps),console.log("Row Count: "+xyPillNumber),console.log("Pallet: "+pallet),console.log("   ... enjoy....");let t=xyPillNumber;t<1&&(t=1),t>128&&(t=128);let l=0,o=0,r=0,i=0,a=t+1*(t+1);for(;o<.1;){let e=(1-2*i)/a;o=0==i?1*e:i,r=e,l=1*e,i=.1,a-=2}let n=whratio*r*2*1.1,d=o/1,p=1-2*d,s=Math.floor(p/n),h=(p-s*n)/(s-1);for(;h<minYSpacing;)s--,h=(p-s*n)/(s-1);let c=n+h,f=Math.floor(random(t*s)),w=0;reseed(seed+pillArray.length);for(let i=d;i<1-d;i+=c){let a=0;for(let n=o;n<1-o;n=n+r+l){let o=rarray(plist[pallet]);if(cy=brightnessAdj(o,.8),whiteCaps&&random(1)>.5&&(o=color(240)),samecolor(o,e)&&(o=rarray(plist[pallet])),e=o,random(1)>.5){let e=o;o=cy,cy=e}let d=disrupted?random(1)>.9:w==f,p=map(t,0,40,3,1),s=(disrupted||nonDisruptedTablets)&&random(1)>.9?"tablet":"pill";"tablet"===s&&a==t-1&&(s="pill");let h=0,c=makePill({pos:w,nx:t,x:n,y:i,w:r,cx:o,cy:cy,xSpacerWidth:l,open:openable&&d,blur:disrupted&&!d?random(p):0,transparent:random(1)>.7,style:s,tint:h,rotation:disrupted?random(-.1,.1):0,gone:!!disrupted&&(!d&&random(1)>.9)});c.number=pillArray.length,pillArray.push(c),w++,a++}}let u="paper"==paperStyle?128:0;shadowPill=makePill({x:0,y:"0",w:r,cx:color(190),cy:color(190),open:!1,blur:0,ratio:whratio,shadow:!0,tint:u})}function makePill(e){let t={color:e.cx,top:!0,open:!1,curve:!0,width:0,height:0},l={color:e.cy,top:!1,open:!1,width:0,height:0};return e.top=t,e.bottom=l,e}function draw(){paper&&paperStart(paperStyle),drawPills()}function drawPills(){pillPointer<pillArray.length?(drawPill(pillArray[pillPointer]),pillPointer++):(paperEnd(paperStyle),noLoop())}function drawPill(e){"tablet"===e.style?(drawTabletPill(e),pillPointer++):drawTruePill(e)}function drawTabletPill(e){tablet(e,e.x*width,e.y*height,e.w*width*2,e.cx)}function drawTruePill(e){let t=e;e.shadowFilled||(fillPillHalf(shadowPill,!0),fillPillHalf(shadowPill,!1),e.shadowFilled=!0),reseed(seed*(22^t.pos)),push();let l=e.x*width,o=e.y*height,r=e.w*width,i=.1*Math.log(e.nx)+(e.nx>6?.1:.05),a=.06*Math.log(e.nx),n=-4.128*Math.log(e.nx)+22.194;e.top.cx,e.top.cy;fillPillHalf(e,!0),fillPillHalf(e,!1),translate(l,o),rotate(e.rotation),e.blur&&(drawingContext.filter="blur("+e.blur+"px)"),null==shaders&&buildShadows(e.w);let d=shaders[e.open?0:1][0],p=shaders[e.open?0:1][1],s=shaders[e.open?0:1][2];if(reseed(seed*(22^t.pos)),shadows&&!e.gone&&(push(),shadowPill.tint>0&&tint(255,shadowPill.tint),e.open?(push(),drawingContext.filter="blur("+n+"px)",image(p,e.w*width*(.5*i),e.w*width*a*2,p.width,.9*p.height),rotate(.15),image(s,e.w*width/2,e.top.height+e.w*width/20),drawingContext.filter="none",pop()):(drawingContext.filter="blur("+n+"px)",image(d,e.w*width*i,e.w*width*a*2,d.width,1.02*d.height),drawingContext.filter="none"),drawingContext.filter="none",pop()),reseed(seed*(22^t.pos)),e.open){let l=map(t.nx,8,28,2,1);push(),drawingContext.filter="blur("+l+"px)";let o="black"===paperStyle?fill(170):fill(110);noStroke();let i=r/20,a=0,n=e.top.height;for(let e=0;e<40+random(20);e++){let e=a+random(1.1*r),t=n+random(n/2);fill(o,o,o,100+random(180)),ellipse(e,t,i+random(2.5*i),i+1.5*random(i))}drawingContext.filter="none",pop()}reseed(seed*(22^t.pos)),e.gone||image(e.top.img,0,0,e.top.width,e.top.height),reseed(seed*(22^t.pos)),e.open?(push(),rotate(.15),image(e.bottom.img,e.w*width/(3+random(4)),1.02*e.top.height-e.nx/64,e.bottom.width,e.bottom.height),pop()):e.gone||image(e.bottom.img,0,e.top.height-4,e.bottom.width,e.bottom.height),drawingContext.filter="none",pop(),p.remove(),d.remove()}function buildShadows(e){shaders=[];let t=e*width*1.2*whratio,l=createGraphics(e*width*2,4+t);l.fill(shadowPill.cx),l.noStroke(),l.rect(0,0,e*width,t,e*width,e*width,e*width,e*width),l.endShape(CLOSE);let o=createGraphics(e*width*2,4+t);o.fill(shadowPill.cx),o.noStroke(),o.rect(0,0,e*width,t,e*width,e*width,0,0),o.endShape(CLOSE);let r=createGraphics(e*width*2,4+t);r.fill(shadowPill.cx),r.noStroke(),r.rect(0,0,e*width,t,0,0,e*width,e*width),r.endShape(CLOSE),shaders.push([l,o,r]),t=e*width*2*whratio,l=createGraphics(e*width*2,4+t),l.fill(shadowPill.cx),l.noStroke(),l.rect(0,0,e*width,t,e*width,e*width,e*width,e*width),l.endShape(CLOSE),o=createGraphics(e*width*2,4+t),o.fill(shadowPill.cx),o.noStroke(),o.rect(0,0,e*width,t,e*width,e*width,0,0),o.endShape(CLOSE),r=createGraphics(e*width*2,4+t),r.fill(shadowPill.cx),r.noStroke(),r.rect(0,0,e*width,t,0,0,e*width,e*width),r.endShape(CLOSE),shaders.push([l,o,r])}function fillPillHalf(e,t){let l=e.w*width,o=t?e.top:e.bottom,r=l+4,i=e.ratio;i||(i=1.5);let a=l*i+4;o.width=r,o.height=a;let n=l*i,d=createGraphics(r,a);o.top?d.rect(2,2,l,n,l,l,1,1):d.rect(2,2,l,n,1,1,l,l);let p=createGraphics(r,a);p.background(o.color);let s=brightnessAdj(o.color,.88);if(p.fill(s),p.noStroke(),e.shadow||p.rect(0,0,r*(1/3),a),reseed(seed*(22^e.pos)),!e.shadow){if(push(),e.transparent){p.drawingContext.filter="blur("+map(e.nx,0,128,3,.1)+"px)";for(let e=0;e<l*n;e++)p.strokeWeight(random(4)),p.stroke(random(80),random(10),random(10),random(50)),p.point(random(r),random(a));p.drawingContext.filter="none"}else{p.drawingContext.filter="blur(1px)";for(let e=0;e<l*n*.4;e++){p.strokeWeight(random(1));let e=random(100);p.stroke(e,e,e,random(50)),p.point(random(r),random(a))}p.drawingContext.filter="none"}pop(),reseed(seed*(22^e.pos)),p.noFill(),p.strokeWeight(l/8),p.stroke(255,255,255,220);let t=60.469*Math.pow(e.nx,-.978);p.drawingContext.filter="blur("+t+"px)";let i=84,d=.35*a;if(o.top){let e=r-2-.18*r;p.line(e,.35*a,e,.88*a)}else{let e=r-2-.18*r;p.line(e,a-.35*a,e,a-.88*a),i=-184,d=a-.35*a}o.curve&&p.arc(.5*r,d,.62*r,.62*r,radians(216+i),radians(238+i))}d.drawingContext.globalCompositeOperation="source-in",e.tint>0&&d.tint(255,e.tint),d.image(p,0,0),d.endShape(CLOSE),o.img=d}function tablet(e,t,l,o,r){reseed(seed*(22^e.pos)),t+=o*map(e.nx,8,128,.75,1.1),l+=o,push(),drawingContext.filter="blur(2px)",e.blur&&(drawingContext.filter="blur("+e.blur+"px)"),translate(t,l);let i=random(2.4,3.5);rotate(i),t=0,l=0;let a=o/4,n=r,d=brightnessAdj(n,.6);fill(140),noStroke(),shadows&&(push(),drawingContext.filter="blur("+map(e.nx,0,128,8,2)+"px)",ellipse(1.02*t,l-.5*a,o,o/4),drawingContext.filter="none",pop()),stroke(d),fill(n);for(let e=l;e<l+a;e+=.5)ellipse(t,e,o,o/4);stroke(n),ellipse(t,l+a,o,o/4),ellipse(t,l+a,o,o/4),ellipse(t,l+a,o,o/4),ellipse(t,l+a,o,o/4),strokeWeight(o/200);let p=o/2,s=o/8,h=colorClone(d);stroke(h);for(let e=0;e<.1;e+=.01){let o=p*cos(e),r=s*sin(e);stroke(d),line(t-o,l+a+r,t+o,l+a+r),stroke(h),line(t-o,l+a-r,t+o,l+a-r),line(t-o,l+a-1-r,t+o,l+a-1-r),h=brightnessAdj(h,.99)}drawingContext.filter="none",pop()}function paperStart(e){"black"===e?(background(color(0)),shadows=!1):"paper"===e?(background(color(240)),paperTexture()):background(color(255)),paper=!1}function paperEnd(e){}function whitePaper(){paperColour2(219,219,197)}function paperColour2(e,t,l){for(let o=0;o<width;o+=1)for(let r=0;r<height;r+=1)if(random(1)>.4){strokeWeight(random(2));let i=random(-10,10),a=color(i+e,i+t,i+l,random(80));stroke(a),point(o,r)}}function keyTyped(){"s"===key&&saveCanvas(_canvas,"pills-"+seed,"png")}function paperTexture(){whitePaper();let e=width,t=height;step=int(width/80),push(),strokeWeight(1),stroke(140),textureLineRatio=.5,whitePaper(),strokeWeight(1);for(let l=0;l<e;l+=step)for(let e=0;e<t;e+=1)if(random(1)>textureLineRatio){let t=random(155),o=color(t,t,t,random(255));stroke(o),point(l,e)}for(let l=0;l<t;l+=step)for(let t=0;t<e;t+=1)if(random(1)>textureLineRatio){let e=random(155),o=color(e,e,e,random(255));stroke(o),point(t,l)}pop()}